PROG=MergeSort
FILE_ENDING=.cpp
CUR_COMPILER=$(CXX)

CC ?= gcc
FLAGS_OPENMP ?= -fopenmpi

ADD_COMPILE_FLAGS=-I../01_util/
ifdef T_AFF_NUMBER_TASKS_MULTIPLICATOR
	ADD_COMPILE_FLAGS += -DT_AFF_NUMBER_TASKS_MULTIPLICATOR=${T_AFF_NUMBER_TASKS_MULTIPLICATOR}
endif
ifdef T_AFF_CUTOFF_DEPTH
	ADD_COMPILE_FLAGS += -DT_AFF_CUTOFF_DEPTH=${T_AFF_CUTOFF_DEPTH}
endif

deb: deb.domain.lowest

deb.domain.rand:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_RAND -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.domain.first:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_FIRST -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.domain.lowest:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_LOWEST -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.domain.private:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_PRIVATE -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.domain.round_robin:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_RR -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.thread.rand:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_RAND -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.thread.first:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_FIRST -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.thread.lowest:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_LOWEST -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.thread.round_robin:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -g -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_RR -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

deb.llvm:
	$(CUR_COMPILER) -Wall -g $(FLAGS_OPENMP) -O0 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe

rel: rel.domain.lowest

rel.domain.rand:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_RAND -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.domain.first:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_FIRST -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.domain.lowest:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_LOWEST -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.domain.private:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_PRIVATE -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.domain.round_robin:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_DOMAIN_RR -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.thread.rand:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_RAND -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.thread.first:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_FIRST -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.thread.lowest:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_LOWEST -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.thread.round_robin:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -DTASK_AFFINITY -DTASK_AFF_THREAD_RR -lnuma -DSCHEDULE_TYPE=${sched} -DSCHEDULE_NUM=${num}

rel.llvm:
	$(CUR_COMPILER) -Wall $(FLAGS_OPENMP) -O3 ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o ${PROG}.exe -lnuma

clean:
	rm -f *.exe *.o *~ bla* nr_* output* pushed_* evol* starts* task_exe* likwid_*
