PROG=stream_task
FILE_ENDING=.c
CUR_COMPILER=$(CC)
FLAGS_COMPILER=-Wall -mcmodel=medium
#ADD_COMPILE_FLAGS=-I/home/jk869269/repos/openmp/ompt_lib/

#ADD_COMPILE_FLAGS=-I../01_util/
#ADD_COMPILE_FLAGS=-I../01_util/ -D_STAT_ARRAYS
ADD_COMPILE_FLAGS=-I../01_util/ -qopt-streaming-stores=always
#ADD_COMPILE_FLAGS=-I../01_util/ -qopt-streaming-stores=always -D_STAT_ARRAYS
ADD_COMPILE_FLAGS_GCC=-I../01_util/

ifdef T_AFF_INVERTED
	ADD_COMPILE_FLAGS += -DT_AFF_INVERTED=${T_AFF_INVERTED}
	ADD_COMPILE_FLAGS_GCC += -DT_AFF_INVERTED=${T_AFF_INVERTED}
endif
ifdef T_AFF_SINGLE_CREATOR
	ADD_COMPILE_FLAGS += -DT_AFF_SINGLE_CREATOR=${T_AFF_SINGLE_CREATOR}
	ADD_COMPILE_FLAGS_GCC += -DT_AFF_SINGLE_CREATOR=${T_AFF_SINGLE_CREATOR}
endif
ifdef T_AFF_NUM_TASK_MULTIPLICATOR
	ADD_COMPILE_FLAGS += -DT_AFF_NUM_TASK_MULTIPLICATOR=${T_AFF_NUM_TASK_MULTIPLICATOR}
	ADD_COMPILE_FLAGS_GCC += -DT_AFF_NUM_TASK_MULTIPLICATOR=${T_AFF_NUM_TASK_MULTIPLICATOR}
endif
ifdef STREAM_ARRAY_SIZE
	ADD_COMPILE_FLAGS += -DSTREAM_ARRAY_SIZE=${STREAM_ARRAY_SIZE}
	ADD_COMPILE_FLAGS_GCC += -DSTREAM_ARRAY_SIZE=${STREAM_ARRAY_SIZE}
endif
ifdef THIRD_INVERTED
	ADD_COMPILE_FLAGS += -DTHIRD_INVERTED=${THIRD_INVERTED}
	ADD_COMPILE_FLAGS_GCC += -DTHIRD_INVERTED=${THIRD_INVERTED}
endif

ADD_COMPILE_FLAGS += -DNTIMES=10
#-D_FILTER_EXEC_TIMES

default: release

release.baseline: PROG=stream_base
release.baseline: release

debug.baseline: PROG=stream_base
debug.baseline: debug

release.gcc: FLAGS_COMPILER=-mcmodel=medium
release.gcc: release

debug.gcc: FLAGS_COMPILER=-mcmodel=medium
debug.gcc: debug

debug: FLAGS_OPTIMIZATION=-g -O0
debug: generic

release: FLAGS_OPTIMIZATION=-O3
release: generic

generic:
	#$(CUR_COMPILER) $(FLAGS_COMPILER) $(FLAGS_OPENMP) $(FLAGS_OPTIMIZATION) ${ADD_COMPILE_FLAGS} task_affinity_support.c 
	$(CUR_COMPILER) $(FLAGS_COMPILER) $(FLAGS_OPENMP) $(FLAGS_OPTIMIZATION) ${ADD_COMPILE_FLAGS} ${PROG}${FILE_ENDING} -o stream_task.exe

clean:
	rm -f *.exe *.o *~ bla* nr_* output_* pushed_* evol* starts* task_exe* likwid_* core.* stats_*
